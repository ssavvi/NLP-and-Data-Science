
## How to use the scripts

This repository has three commandline-friendly scripts which combined cover a large fraction of the code base. They are:
* `download_pubmed_by_mesh.py` which handles downloading of pubmed abstracts by their depth ("layer") in the MeSH tree  
* `topic_model_abstracts.py` which fits a topic model to the abstracts and compares the fitted topics to the MeSH labels
* `supervised_crossval.py` which creates scikit-learn pipelines to fit various classifiers to predict MeSH labels, and tests them with cross-validation

Generally this is the order they should be run in.

### Downloading articles

The minimal requirements to run the first script is  to specify the MeSH layer from which to download articles. This can be done as 
```
python download_pubmed_by_mesh.py -l 0
```
where the flag `-l` (or, alternatively, `--layer`) followed by an integer (0, 1, or 2) specifies the layer. If left out, the default is 1. If this works correctly, one should see updates of the form of
```
Fetching articles 1000 to 2000 of N
...
```
where `N` is the total number of articles which will be fetched.

**More details**

query for help by running
```
python download_pubmed_by_mesh.py -h
```
(or replacing the `-h` flag with `--help`) which will print out all of the arguments and what they do. Replacing `download_pubmed_by_mesh.py` with the appropriate script name will get help for any of these scripts.


**Specifying the output**

In this default mode, the articles will be saved as a csv to `abstracts-{layer}.csv` where `layer` is the value of the input layer argument. If a different output is desired, such as saving to the temp directory, this can be done by setting the `-o` (or `--output`) flag, such as
```
python download_pubmed_by_mesh.py -l 0 -o "/tmp/abstracts-0.csv"
```


**Downloading features**

There are 3 more arguments for this file: `-m` (or `--maximum`), `--max_query` and `--min_abstract_len`. In order, they specify the maximum number of articles for each MeSH term (default 1000), the maximum number of pubmed IDs which are queried for (before filtering away articles which come from more than one MeSH term; default 5000) and the minimum length in characters (default 5) of any abstract (abstracts shorter than this are replaced by `np.nan`).

```
python download_pubmed_by_mesh.py -l 1 -m 100 --max--query 10000 --min_abstract_len 200 -o "/tmp/custom_filename.csv"
```

### Topic modeling articles

The second script has many more arguments, most importantly the input and the output. The input, specified with flag `-i` or `--input`, is the path of the file generated by the previous script. This file will be extended with topic modeled features (such as the strongest topic for each document) and saved to the output file specified by `-o` or `--output`. Everything in the input will be kept in the output, so one can overwrite the input by setting the input and the output to the same value, such as by
```
python topic_model_abstracts.py -i "/tmp/custom_filename.csv" -o "/tmp/custom_filename.csv"
```

The default input is `abstracts-{layer}.csv`, while the default output is `topic-modeled-abstracts-{layer}.csv` where `layer` is the corresponding layer argument, specified with `-l` or `--layer`. This layer argument in turn defaults to 1.


### Testing Supervised Models
```
python3 supervised_crossval.py -i  'topic-modeled-abstracts-2.csv' -l 2

```